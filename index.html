<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WETO Token - Simple Sale</title>
    
    <!-- SEO -->
    <meta name="description" content="Simple WETO Token Sale on BSC Testnet - Buy and get tokens instantly!">
    <meta name="keywords" content="WETO, Token, Cryptocurrency, Blockchain, DeFi, Pre-Sale, Testnet">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #0066FF;
            --secondary: #00E896;
            --accent: #FF6B35;
            --warning: #FFB800;
            --success: #00C896;
            --error: #FF4757;
            --neutral-0: #FFFFFF;
            --neutral-100: #F1F5F9;
            --neutral-200: #E2E8F0;
            --neutral-300: #CBD5E1;
            --neutral-600: #475569;
            --neutral-900: #0F172A;
            --text-primary: var(--neutral-900);
            --text-secondary: var(--neutral-600);
            --gradient-primary: linear-gradient(135deg, #0066FF 0%, #00E896 100%);
            --gradient-surface: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(248, 250, 252, 0.8) 100%);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --radius-lg: 16px;
            --radius-xl: 24px;
            --space-lg: 24px;
            --space-xl: 32px;
            --space-2xl: 48px;
            --space-3xl: 64px;
            --font-size-sm: 14px;
            --font-size-md: 16px;
            --font-size-lg: 18px;
            --font-size-2xl: 24px;
            --font-size-4xl: 36px;
        }

        [data-theme="dark"] {
            --neutral-0: var(--neutral-900);
            --neutral-100: #1E293B;
            --neutral-200: #334155;
            --text-primary: #FFFFFF;
            --text-secondary: #CBD5E1;
            --gradient-surface: linear-gradient(135deg, rgba(30, 41, 59, 0.9) 0%, rgba(15, 23, 42, 0.8) 100%);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Inter', system-ui, sans-serif;
            background: var(--neutral-0);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--space-xl);
        }

        .header {
            text-align: center;
            margin-bottom: var(--space-3xl);
        }

        .logo {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            margin-bottom: var(--space-lg);
            text-decoration: none;
            color: var(--text-primary);
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: var(--gradient-primary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 900;
            font-size: 24px;
        }

        .title {
            font-size: var(--font-size-4xl);
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: var(--space-lg);
        }

        .subtitle {
            font-size: var(--font-size-lg);
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(255, 184, 0, 0.1);
            border: 1px solid rgba(255, 184, 0, 0.3);
            border-radius: 999px;
            font-size: var(--font-size-sm);
            font-weight: 600;
            color: var(--warning);
            margin-bottom: var(--space-xl);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: var(--warning);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space-xl);
            margin-bottom: var(--space-3xl);
        }

        .card {
            background: var(--gradient-surface);
            border-radius: var(--radius-xl);
            padding: var(--space-xl);
            box-shadow: var(--shadow-lg);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .card h2 {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            margin-bottom: var(--space-lg);
            color: var(--text-primary);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-lg);
            margin-bottom: var(--space-lg);
        }

        .stat {
            text-align: center;
            padding: var(--space-lg);
            background: rgba(0, 102, 255, 0.05);
            border-radius: var(--radius-lg);
        }

        .stat-value {
            font-size: var(--font-size-2xl);
            font-weight: 800;
            color: var(--primary);
            font-family: 'JetBrains Mono', monospace;
            display: block;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-group {
            margin-bottom: var(--space-lg);
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .input-group {
            display: flex;
            border: 2px solid var(--neutral-200);
            border-radius: 12px;
            overflow: hidden;
            background: white;
            transition: border-color 0.3s ease;
        }

        .input-group:focus-within {
            border-color: var(--primary);
        }

        .form-input {
            flex: 1;
            border: none;
            padding: 16px;
            font-size: var(--font-size-md);
            font-family: 'JetBrains Mono', monospace;
            outline: none;
        }

        .input-addon {
            display: flex;
            align-items: center;
            padding: 16px;
            background: var(--neutral-100);
            color: var(--text-secondary);
            font-weight: 600;
            font-size: var(--font-size-sm);
        }

        .calculation {
            background: rgba(0, 232, 150, 0.1);
            border: 1px solid rgba(0, 232, 150, 0.3);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            margin: var(--space-lg) 0;
        }

        .calc-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .calc-row:last-child {
            border-top: 1px solid rgba(0, 232, 150, 0.3);
            padding-top: 8px;
            margin-top: 8px;
            font-weight: 700;
        }

        .btn {
            background: var(--gradient-primary);
            border: none;
            border-radius: 12px;
            padding: 16px 32px;
            color: white;
            font-weight: 600;
            font-size: var(--font-size-md);
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            box-shadow: var(--shadow-lg);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
        }

        .btn:disabled {
            background: var(--neutral-300);
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-secondary:hover {
            background: var(--primary);
            color: white;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid var(--neutral-200);
            border-radius: 12px;
            padding: 16px 20px;
            box-shadow: var(--shadow-xl);
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success { border-left: 4px solid var(--success); }
        .toast.error { border-left: 4px solid var(--error); }
        .toast.warning { border-left: 4px solid var(--warning); }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--gradient-primary);
            border: none;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            color: white;
            font-size: 20px;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            z-index: 100;
        }

        .countdown {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-lg);
            margin: var(--space-xl) 0;
        }

        .countdown-item {
            text-align: center;
            padding: var(--space-lg);
            background: var(--gradient-surface);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
        }

        .countdown-number {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary);
            font-family: 'JetBrains Mono', monospace;
            display: block;
        }

        .countdown-label {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 4px;
        }

        .wallet-status {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: var(--space-lg);
            font-size: var(--font-size-sm);
            font-weight: 600;
        }

        .wallet-connected {
            background: rgba(0, 200, 150, 0.1);
            color: var(--success);
            border: 1px solid rgba(0, 200, 150, 0.3);
        }

        .wallet-disconnected {
            background: rgba(255, 71, 87, 0.1);
            color: var(--error);
            border: 1px solid rgba(255, 71, 87, 0.3);
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .container { padding: 16px; }
            .cards-grid { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: 1fr; }
            .countdown { grid-template-columns: repeat(2, 1fr); }
            .title { font-size: 2rem; }
        }
    </style>
</head>
<body data-theme="light">
    <button class="theme-toggle" onclick="toggleTheme()" id="themeToggle">🌙</button>

    <div class="container">
        <div class="header">
            <a href="#" class="logo">
                <div class="logo-icon">W</div>
                <span style="font-size: 24px; font-weight: 800;">WETO</span>
            </a>
            
            <div class="badge">
                <div class="status-dot"></div>
                <span>BSC Testnet • Live Sale</span>
            </div>
            
            <h1 class="title">Simple WETO Token Sale</h1>
            <p class="subtitle">
                Buy WETO tokens instantly! No caps, no waiting - get your tokens immediately after purchase.
            </p>
        </div>

        <!-- Countdown -->
        <div class="countdown" id="countdown">
            <div class="countdown-item">
                <span class="countdown-number" id="days">0</span>
                <span class="countdown-label">Days</span>
            </div>
            <div class="countdown-item">
                <span class="countdown-number" id="hours">0</span>
                <span class="countdown-label">Hours</span>
            </div>
            <div class="countdown-item">
                <span class="countdown-number" id="minutes">0</span>
                <span class="countdown-label">Minutes</span>
            </div>
            <div class="countdown-item">
                <span class="countdown-number" id="seconds">0</span>
                <span class="countdown-label">Seconds</span>
            </div>
        </div>

        <div class="cards-grid">
            <!-- Sale Info Card -->
            <div class="card">
                <h2>📊 Sale Information</h2>
                <div class="stats-grid">
                    <div class="stat">
                        <span class="stat-value" id="tokenPrice">1,000</span>
                        <span class="stat-label">WETO per tBNB</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="bonusPercent">10%</span>
                        <span class="stat-label">Bonus Tokens</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="totalSold">0</span>
                        <span class="stat-label">Tokens Sold</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="totalRaised">0</span>
                        <span class="stat-label">BNB Raised</span>
                    </div>
                </div>
                
                <div style="margin-top: var(--space-lg);">
                    <div style="font-size: var(--font-size-sm); color: var(--text-secondary); margin-bottom: 8px;">
                        Sale Period: August 12 - August 31, 2025
                    </div>
                    <div style="font-size: var(--font-size-sm); color: var(--text-secondary);">
                        Status: <span id="saleStatus" style="font-weight: 600;">Loading...</span>
                    </div>
                </div>
            </div>

            <!-- Purchase Card -->
            <div class="card">
                <h2>💰 Buy WETO Tokens</h2>
                
                <div class="wallet-status" id="walletStatus">
                    <div class="wallet-disconnected">
                        ❌ Wallet not connected
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Amount (tBNB)</label>
                    <div class="input-group">
                        <input type="number" class="form-input" id="buyAmount" placeholder="0.1" min="0.001" step="0.001" value="0.1">
                        <div class="input-addon">tBNB</div>
                    </div>
                </div>

                <div class="calculation" id="calculation">
                    <div class="calc-row">
                        <span>Base Tokens:</span>
                        <span id="baseTokens">100</span>
                    </div>
                    <div class="calc-row">
                        <span>Bonus (10%):</span>
                        <span id="bonusTokens">10</span>
                    </div>
                    <div class="calc-row">
                        <span>Total You Get:</span>
                        <span id="totalTokens">110 WETO</span>
                    </div>
                </div>

                <button class="btn" id="connectBtn" onclick="connectWallet()">
                    Connect Wallet
                </button>

                <button class="btn" id="buyBtn" onclick="buyTokens()" style="display: none;" disabled>
                    Buy Tokens
                </button>
            </div>
        </div>

        <!-- User Stats -->
        <div class="card" id="userStats" style="display: none;">
            <h2>👤 Your Purchases</h2>
            <div class="stats-grid">
                <div class="stat">
                    <span class="stat-value" id="userTokens">0</span>
                    <span class="stat-label">WETO Purchased</span>
                </div>
                <div class="stat">
                    <span class="stat-value" id="userContribution">0</span>
                    <span class="stat-label">tBNB Contributed</span>
                </div>
            </div>
        </div>

        <!-- Contract Info -->
        <div class="card">
            <h2>📋 Contract Information</h2>
            <div style="font-family: 'JetBrains Mono', monospace; font-size: var(--font-size-sm); line-height: 1.8;">
                <div style="margin-bottom: 8px;">
                    <strong>Token:</strong> 
                    <span style="color: var(--primary); cursor: pointer;" onclick="copyToClipboard('0xBb3BD507dBc10ffef858Ddbf32241e1Dd107349b')">
                        0xBb3BD507dBc10ffef858Ddbf32241e1Dd107349b
                    </span>
                </div>
                <div>
                    <strong>Sale:</strong> 
                    <span id="saleContractAddress" style="color: var(--primary); cursor: pointer;">
                        Deploy new contract first
                    </span>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.7.0/web3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <script>
        // Global Variables
        let web3 = null;
        let userAccount = null;
        let isConnected = false;
        let saleContract = null;
        let tokenContract = null;
        let countdownInterval;

        const CONFIG = {
            // 새로운 심플 세일 컨트랙트 주소 (배포 후 업데이트 필요)
            tokenAddress: '0xBb3BD507dBc10ffef858Ddbf32241e1Dd107349b',
            saleAddress: '', // 새 컨트랙트 배포 후 설정
            
            chainId: '0x61', // BSC Testnet
            rpcUrl: 'https://data-seed-prebsc-1-s1.binance.org:8545/',
            chainName: 'BSC Testnet',
            nativeCurrency: { name: 'tBNB', symbol: 'tBNB', decimals: 18 },
            blockExplorerUrls: ['https://testnet.bscscan.com'],
            
            saleEndTime: new Date('2025-08-31T23:59:59Z').getTime()
        };

        const SALE_ABI = [
            "function getSaleInfo() view returns (uint256, uint256, uint256, uint256, uint256, uint256, bool, uint256)",
            "function getUserInfo(address) view returns (uint256, uint256)",
            "function calculateTokenAmount(uint256) view returns (uint256, uint256, uint256)",
            "function buyTokens() payable",
            "function isSaleActive() view returns (bool)",
            "event TokensPurchased(address indexed buyer, uint256 bnbAmount, uint256 tokenAmount, uint256 bonusAmount, uint256 totalReceived)"
        ];

        // Theme Management
        function toggleTheme() {
            const body = document.body;
            const toggle = document.getElementById('themeToggle');
            const isDark = body.getAttribute('data-theme') === 'dark';
            
            body.setAttribute('data-theme', isDark ? 'light' : 'dark');
            toggle.textContent = isDark ? '🌙' : '☀️';
            localStorage.setItem('theme', isDark ? 'light' : 'dark');
        }

        function initTheme() {
            const theme = localStorage.getItem('theme') || 'light';
            document.body.setAttribute('data-theme', theme);
            document.getElementById('themeToggle').textContent = theme === 'dark' ? '☀️' : '🌙';
        }

        // Wallet Connection
        async function connectWallet() {
            if (typeof window.ethereum === 'undefined') {
                showToast('Please install MetaMask!', 'error');
                return;
            }

            try {
                setButtonLoading('connectBtn', true);
                
                const accounts = await window.ethereum.request({
                    method: 'eth_requestAccounts'
                });

                const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                
                if (chainId !== CONFIG.chainId) {
                    await switchToTestnet();
                }

                web3 = new Web3(window.ethereum);
                userAccount = accounts[0];
                isConnected = true;

                await updateWalletUI();
                await initializeContracts();
                
                showToast('Wallet connected successfully!', 'success');
                
            } catch (error) {
                console.error('Connection failed:', error);
                showToast('Connection failed: ' + error.message, 'error');
            } finally {
                setButtonLoading('connectBtn', false);
            }
        }

        async function switchToTestnet() {
            try {
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: CONFIG.chainId }]
                });
            } catch (error) {
                if (error.code === 4902) {
                    await window.ethereum.request({
                        method: 'wallet_addEthereumChain',
                        params: [{
                            chainId: CONFIG.chainId,
                            chainName: CONFIG.chainName,
                            nativeCurrency: CONFIG.nativeCurrency,
                            rpcUrls: [CONFIG.rpcUrl],
                            blockExplorerUrls: CONFIG.blockExplorerUrls
                        }]
                    });
                } else {
                    throw error;
                }
            }
        }

        async function initializeContracts() {
            if (!CONFIG.saleAddress) {
                showToast('Please deploy the new sale contract first!', 'warning');
                return;
            }

            try {
                const provider = new ethers.providers.Web3Provider(window.ethereum);
                saleContract = new ethers.Contract(CONFIG.saleAddress, SALE_ABI, provider);
                
                await loadSaleInfo();
                await loadUserInfo();
                
            } catch (error) {
                console.error('Contract initialization failed:', error);
                showToast('Failed to connect to contracts', 'error');
            }
        }

        async function loadSaleInfo() {
            if (!saleContract) return;
            
            try {
                const info = await saleContract.getSaleInfo();
                const isActive = await saleContract.isSaleActive();
                
                document.getElementById('tokenPrice').textContent = info[0].toString();
                document.getElementById('bonusPercent').textContent = info[1].toString() + '%';
                document.getElementById('totalSold').textContent = formatNumber(ethers.utils.formatEther(info[2]));
                document.getElementById('totalRaised').textContent = parseFloat(ethers.utils.formatEther(info[3])).toFixed(2);
                document.getElementById('saleStatus').textContent = isActive ? '🟢 Active' : '🔴 Inactive';
                
            } catch (error) {
                console.error('Failed to load sale info:', error);
            }
        }

        async function loadUserInfo() {
            if (!saleContract || !userAccount) return;
            
            try {
                const userInfo = await saleContract.getUserInfo(userAccount);
                
                const tokens = parseFloat(ethers.utils.formatEther(userInfo[0]));
                const contribution = parseFloat(ethers.utils.formatEther(userInfo[1]));
                
                document.getElementById('userTokens').textContent = formatNumber(tokens);
                document.getElementById('userContribution').textContent = contribution.toFixed(4);
                
                if (tokens > 0 || contribution > 0) {
                    document.getElementById('userStats').style.display = 'block';
                }
                
            } catch (error) {
                console.error('Failed to load user info:', error);
            }
        }

        async function updateWalletUI() {
            if (!isConnected || !userAccount) return;

            try {
                const balance = await web3.eth.getBalance(userAccount);
                const bnbBalance = web3.utils.fromWei(balance, 'ether');
                
                const walletStatus = document.getElementById('walletStatus');
                walletStatus.innerHTML = `
                    <div class="wallet-connected">
                        ✅ ${userAccount.slice(0, 6)}...${userAccount.slice(-4)} 
                        (${parseFloat(bnbBalance).toFixed(4)} tBNB)
                    </div>
                `;
                
                document.getElementById('connectBtn').style.display = 'none';
                document.getElementById('buyBtn').style.display = 'block';
                document.getElementById('buyBtn').disabled = false;
                
            } catch (error) {
                console.error('Failed to update wallet UI:', error);
            }
        }

        async function calculateTokens() {
            const amount = parseFloat(document.getElementById('buyAmount').value) || 0;
            
            if (amount <= 0) {
                document.getElementById('baseTokens').textContent = '0';
                document.getElementById('bonusTokens').textContent = '0';
                document.getElementById('totalTokens').textContent = '0 WETO';
                return;
            }
            
            if (saleContract) {
                try {
                    const amountWei = ethers.utils.parseEther(amount.toString());
                    const result = await saleContract.calculateTokenAmount(amountWei);
                    
                    const base = formatNumber(ethers.utils.formatEther(result[0]));
                    const bonus = formatNumber(ethers.utils.formatEther(result[1]));
                    const total = formatNumber(ethers.utils.formatEther(result[2]));
                    
                    document.getElementById('baseTokens').textContent = base;
                    document.getElementById('bonusTokens').textContent = bonus;
                    document.getElementById('totalTokens').textContent = total + ' WETO';
                    
                } catch (error) {
                    console.error('Calculation failed:', error);
                }
            } else {
                // Fallback calculation
                const baseTokens = amount * 1000;
                const bonusTokens = baseTokens * 0.1;
                const totalTokens = baseTokens + bonusTokens;
                
                document.getElementById('baseTokens').textContent = formatNumber(baseTokens);
                document.getElementById('bonusTokens').textContent = formatNumber(bonusTokens);
                document.getElementById('totalTokens').textContent = formatNumber(totalTokens) + ' WETO';
            }
        }

        async function buyTokens() {
            if (!saleContract || !isConnected) {
                showToast('Please connect your wallet first!', 'error');
                return;
            }

            const amount = parseFloat(document.getElementById('buyAmount').value);
            if (!amount || amount <= 0) {
                showToast('Please enter a valid amount!', 'error');
                return;
            }

            try {
                setButtonLoading('buyBtn', true);
                
                const provider = new ethers.providers.Web3Provider(window.ethereum);
                const signer = provider.getSigner();
                const saleContractWithSigner = saleContract.connect(signer);
                
                const amountWei = ethers.utils.parseEther(amount.toString());
                
                showToast('Sending transaction...', 'success');
                
                const tx = await saleContractWithSigner.buyTokens({
                    value: amountWei
                });
                
                showToast('Transaction sent! Waiting for confirmation...', 'success');
                
                const receipt = await tx.wait();
                
                if (receipt.status === 1) {
                    showToast('Purchase successful! Tokens sent to your wallet! 🎉', 'success');
                    
                    setTimeout(() => {
                        showToast(`View transaction: https://testnet.bscscan.com/tx/${tx.hash}`, 'success');
                    }, 2000);
                    
                    await loadSaleInfo();
                    await loadUserInfo();
                    await updateWalletUI();
                    
                } else {
                    throw new Error('Transaction failed');
                }
                
            } catch (error) {
                console.error('Purchase failed:', error);
                let errorMsg = 'Purchase failed';
                
                if (error.code === 4001) {
                    errorMsg = 'Transaction rejected by user';
                } else if (error.message.includes('insufficient funds')) {
                    errorMsg = 'Insufficient funds';
                } else if (error.message.includes('Sale has ended')) {
                    errorMsg = 'Sale has ended';
                } else if (error.message) {
                    errorMsg = error.message;
                }
                
                showToast(errorMsg, 'error');
            } finally {
                setButtonLoading('buyBtn', false);
            }
        }

        // Countdown Timer
        function initCountdown() {
            const endTime = CONFIG.saleEndTime;
            
            function updateCountdown() {
                const now = Date.now();
                const distance = endTime - now;
                
                if (distance < 0) {
                    document.querySelectorAll('.countdown-number').forEach(el => {
                        el.textContent = '00';
                    });
                    return;
                }
                
                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                
                document.getElementById('days').textContent = days.toString().padStart(2, '0');
                document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
                document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
                document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
            }
            
            updateCountdown();
            countdownInterval = setInterval(updateCountdown, 1000);
        }

        // Utility Functions
        function formatNumber(num) {
            const number = parseFloat(num);
            if (number >= 1000000) {
                return (number / 1000000).toFixed(1) + 'M';
            } else if (number >= 1000) {
                return (number / 1000).toFixed(1) + 'K';
            } else {
                return number.toLocaleString();
            }
        }

        function setButtonLoading(buttonId, loading) {
            const button = document.getElementById(buttonId);
            if (loading) {
                button.innerHTML = '<span class="spinner"></span>Processing...';
                button.disabled = true;
            } else {
                if (buttonId === 'connectBtn') {
                    button.innerHTML = 'Connect Wallet';
                } else if (buttonId === 'buyBtn') {
                    button.innerHTML = 'Buy Tokens';
                }
                button.disabled = false;
            }
        }

        function showToast(message, type = 'success') {
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }

            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;

            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, type === 'error' ? 7000 : 5000);
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast('Address copied to clipboard!', 'success');
            });
        }

        // Event Listeners
        document.getElementById('buyAmount').addEventListener('input', calculateTokens);

        document.addEventListener('DOMContentLoaded', function() {
            initTheme();
            initCountdown();
            calculateTokens();
            
            // Auto-connect if previously connected
            if (localStorage.getItem('walletConnected') === 'true') {
                setTimeout(() => {
                    if (typeof window.ethereum !== 'undefined') {
                        connectWallet();
                    }
                }, 1000);
            }
            
            showToast('🧪 Welcome to WETO Simple Sale on BSC Testnet!', 'success');
        });

        if (typeof window.ethereum !== 'undefined') {
            window.ethereum.on('accountsChanged', (accounts) => {
                if (accounts.length === 0) {
                    isConnected = false;
                    userAccount = null;
                    localStorage.setItem('walletConnected', 'false');
                    location.reload();
                } else if (accounts[0] !== userAccount) {
                    location.reload();
                }
            });

            window.ethereum.on('chainChanged', () => {
                location.reload();
            });
        }

        window.addEventListener('beforeunload', () => {
            if (isConnected) {
                localStorage.setItem('walletConnected', 'true');
            }
        });

        // Set new sale contract address here after deployment
        // CONFIG.saleAddress = '0xA4BC1d44EBCc8B4b10677Af79CE087647c147fb1';
    </script>
</body>
</html>